---
import type { CollectionEntry } from 'astro:content'
import { generateArtworkSchema, generateBreadcrumbSchema, organizationSchema, personSchema, websiteSchema } from '@/lib/schema'

interface Props {
  artwork: CollectionEntry<'artwork'>
  imageUrl: string
  imageWidth: number
  imageHeight: number
}

const { artwork, imageUrl, imageWidth, imageHeight } = Astro.props
const pageUrl = new URL(Astro.url.pathname, Astro.site)

// Artwork pages have 3 levels
const breadcrumbItems = [
  { name: 'Home', item: new URL('/', Astro.site).toString() },
  { name: 'Art', item: new URL('/art', Astro.site).toString() },
  { name: artwork.data.title, item: pageUrl.toString() },
]

const schema = {
  '@context': 'https://schema.org',
  '@graph': [
    generateArtworkSchema(artwork, pageUrl, imageUrl, imageWidth, imageHeight),
    generateBreadcrumbSchema(breadcrumbItems),
    {
      '@type': 'WebPage',
      '@id': pageUrl.toString(),
      'url': pageUrl.toString(),
      'name': artwork.data.title,
      'isPartOf': {
        '@id': 'https://fractalcounty.com/#website',
      },
      'primaryImageOfPage': {
        '@id': `${pageUrl.toString()}#artwork-image`,
      },
      'breadcrumb': {
        '@id': `${pageUrl.toString()}#breadcrumb`,
      },
    },
    {
      '@type': 'ImageObject',
      '@id': `${pageUrl.toString()}#artwork-image`,
      'url': imageUrl,
      'width': imageWidth,
      'height': imageHeight,
      'caption': artwork.data.title,
    },
    websiteSchema,
    organizationSchema,
    personSchema,
  ],
}
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
