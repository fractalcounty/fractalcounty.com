---
import ImageCard from '@components/ImageCard.astro'
import Link from '@components/Link.astro'
import { Icon } from 'astro-icon/components'
import TwitterFonts from './fonts/TwitterFonts.astro'

interface QuotedTweet {
  name: string
  handle: string
  text?: string
  pfp: string
  imageUrl?: string
}

interface Props {
  name?: string
  handle?: string
  pfp?: string
  text?: string
  imageUrl?: string
  hashtags?: string
  retweets?: string
  replies?: string
  likes?: string
  src?: string
  quotedTweet?: QuotedTweet
}

const {
  name = 'chip',
  handle = 'chippledipple',
  pfp = '/src/content/blog/smpearth/chip-pfp.webp',
  text,
  imageUrl,
  retweets = '100k',
  replies = '50k',
  likes = '300k',
  src = 'https://twitter.com',
  quotedTweet,
} = Astro.props

const hasContent = text || imageUrl
---

<TwitterFonts />

<div
  class='tweet prose prose-sm mx-auto my-auto rounded-lg bg-neutral p-6 text-base-content shadow-lg outline outline-neutral-content/75'
  role='article'
  aria-label={`Tweet by ${name}`}
  style='margin-top: 2rem; margin-bottom: 2rem;'
>
  <div class='header flex items-start pr-2'>
    <div
      class='avatar mr-[16px] size-12 flex-shrink-0 overflow-hidden rounded-full'
    >
      <ImageCard
        imagePath={pfp}
        altText={`${name}'s avatar`}
        showShadow={false}
        rounded={false}
        showCaption={false}
        class='h-full w-full'
        imageClass='w-full h-full object-cover'
      />
    </div>

    <div class='flex-grow'>
      <div class='flex items-center justify-between'>
        <div class='info'>
          <span class='username'>{name}</span>
          <span class='handle' aria-label={`${handle} username`}>@{handle}</span
          >
        </div>
      </div>

      {text && <p class='body text-base-content'>{text}</p>}

      {
        imageUrl && (
          <div class={`tweet-image ${text ? '-mt-3' : ''} -my-4`}>
            <ImageCard
              imagePath={imageUrl}
              altText='Tweet media'
              showShadow={false}
              rounded={true}
              showCaption={false}
              class='w-full'
              imageClass='w-full h-auto object-cover rounded-lg'
            />
          </div>
        )
      }

      {
        quotedTweet && (
          <div
            class='quoted-tweet mb-3 mt-3 rounded-lg border border-neutral-content bg-neutral pb-3 pl-3 pr-3 pt-2'
            role='article'
            aria-label={`Quoted tweet by ${quotedTweet.name}`}
          >
            <div class='flex items-center gap-2'>
              <span class='quoted-pfp size-6 flex-shrink-0 overflow-hidden rounded-full'>
                <ImageCard
                  imagePath={quotedTweet.pfp}
                  altText={`${quotedTweet.name}'s avatar`}
                  showShadow={false}
                  rounded={false}
                  showCaption={false}
                  class='h-full w-full'
                  imageClass='w-full h-full object-cover'
                />
              </span>

              <div class='info'>
                <span class='username'>{quotedTweet.name}</span>
                <span class='handle'>@{quotedTweet.handle}</span>
              </div>
            </div>

            {quotedTweet.text && <p class='body'>{quotedTweet.text}</p>}
            {quotedTweet.imageUrl && (
              <div class={`tweet-image ${quotedTweet.text ? 'mt-2' : ''} mb-2`}>
                <ImageCard
                  imagePath={quotedTweet.imageUrl}
                  altText='Quoted tweet media'
                  showShadow={false}
                  rounded={true}
                  showCaption={false}
                  class='w-full'
                  imageClass='w-full h-auto object-cover rounded-lg'
                />
              </div>
            )}
          </div>
        )
      }

      {
        hasContent && (
          <div
            class='actions mt-2 flex items-center justify-between bg-inherit text-accent-content'
            role='group'
            aria-label='Tweet actions'
          >
            <button class='action' aria-label={`Reply, ${replies} replies`}>
              <Icon name='lucide:message-square' />
              <span>{replies}</span>
            </button>
            <button class='action' aria-label={`Retweet, ${retweets} retweets`}>
              <Icon name='lucide:repeat' />
              <span>{retweets}</span>
            </button>
            <button class='action' aria-label={`Like, ${likes} likes`}>
              <Icon name='lucide:heart' />
              <span>{likes}</span>
            </button>
            <Link
              href={src}
              class='menu tooltip tooltip-bottom tooltip-primary flex items-center justify-center text-accent-content'
              data-tip='View original source'
              underline={false}
              externalInNewTab={true}
              aria-label='View original tweet'
            >
              <Icon name='lucide:link' class='size-4' />
            </Link>
          </div>
        )
      }
    </div>
  </div>
</div>

<style>
  :global(.tooltip) {
    font-weight: normal !important;
    font-family: 'Inter', sans-serif !important;
  }

  :global(.tooltip:before) {
    font-weight: normal !important;
    font-family: 'Inter', sans-serif !important;
  }

  .tweet {
    font-family: 'Chirp', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    @apply prose-base p-4;
  }

  .tweet * {
    font-family: inherit !important;
  }

  .tweet > * {
    @apply !m-0;
  }

  .tweet :global(p) {
    @apply !m-0;
  }

  .info {
    @apply flex flex-row items-center justify-center space-x-1;
  }

  .username {
    @apply font-semibold;
  }

  .handle {
    @apply font-normal text-accent-content;
  }

  .body {
    font-weight: 400;
    @apply !m-0 leading-5;
  }

  .quoted-pfp {
    position: relative;
    padding: 0 !important;
  }

  .quoted-pfp :global(*) {
    padding: 0 !important;
    margin: 0 !important;
  }

  .quoted-pfp :global(img) {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    padding: 0 !important;
    margin: 0 !important;
  }

  .avatar {
    position: relative;
  }

  .avatar :global(img) {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .action {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: color 0.2s ease;
    @apply text-sm;
  }

  .action:hover {
    color: oklch(var(--p));
  }

  .action :global(svg) {
    width: 1.25rem;
    height: 1.25rem;
    display: block;
  }

  .header {
    align-items: flex-start;
  }

  .tweet :global(p) {
    @apply m-0;
  }

  .tweet-image {
    max-width: 100%;
    overflow: hidden;
  }

  .tweet-image :global(img) {
    max-height: 300px;
    width: 100%;
    object-fit: cover;
  }
</style>
