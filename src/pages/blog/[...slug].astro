---
import Container from '@/components/layout/Container.astro'
import Subheader from '@/components/layout/Subheader.astro'
import PostStructuredData from '@/components/meta/PostStructuredData.astro'
import PageLayout from '@/layouts/PageLayout.astro'
import { readingTime } from '@/lib/utils'
import { getCollection, render } from 'astro:content'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts
    .filter(post => !post.data.draft)
    .map(post => ({
      params: {
        slug: post.id,
      },
      props: { post },
    }))
}
const { post } = Astro.props
const { Content } = await render(post)
---

<PageLayout
  title={post.data.title}
  description={post.data.description}
  type="article"
  publishedTime={post.data.date}
  tags={post.data.tags}
  isContentPage={true}
>
  <PostStructuredData
    slot="structured-data"
    entry={post}
    type="blog"
  />
  <Container as="main">
    <div class="my-10">
      <Subheader
        title={post.data.title}
        date={post.data.date}
        readingTime={readingTime(post.body || '')}
        backUrl="/blog"
        backLabel="Back"
      />
    </div>

    <article class="animate">
      <Content />
    </article>
  </Container>
</PageLayout>
